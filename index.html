<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>FTE Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --app-header-h: 56px;
      --left-col-w: 280px;
      --row-h: 120px;
    }
    .btn{ @apply px-3 py-1.5 rounded-xl text-sm font-medium border border-neutral-300 bg-white hover:bg-neutral-50 transition; }
    .btn-ghost{ @apply px-3 py-1.5 rounded-xl text-sm font-medium bg-white text-neutral-800 border border-neutral-300 hover:bg-neutral-50 transition; }
    .btn-solid{ @apply px-3 py-1.5 rounded-xl text-sm font-medium bg-neutral-900 text-white hover:opacity-90 transition; }
    .tag{ @apply px-2 py-0.5 rounded-md text-xs border border-neutral-200 bg-neutral-50 text-neutral-700; }
  </style>
</head>
<body class="bg-[#F7F8FA] text-neutral-900">
  <div id="root"></div>

  <!-- React/Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const {useState, useMemo, useEffect, Fragment} = React;

    /* ======================= –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ======================= */
    const WEEK_COL_PX = 140;

    const RU_MONTHS_FULL = ["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];

    const startOfWeek = (d) => {
      const x = new Date(d); const day = x.getDay(); // 0 Su .. 6 Sa
      const diff = (day === 0 ? -6 : 1 - day); // ISO Monday
      x.setDate(x.getDate() + diff);
      x.setHours(0,0,0,0);
      return x;
    };
    const addWeeks = (iso, n) => {
      const d = new Date(iso);
      d.setDate(d.getDate() + n*7);
      return d.toISOString();
    };
    const weeksRange = (anchorISO, count=12) => {
      const a = startOfWeek(new Date(anchorISO));
      const list = [];
      for(let i=0;i<count;i++){
        const d = new Date(a); d.setDate(a.getDate()+i*7);
        list.push(d.toISOString());
      }
      return list;
    };
    const fmtFTE1 = (f) => (Math.round((f||0)*10)/10).toFixed(1);
    const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
    const scaleRatio = (fte)=> clamp((fte||0)/1.0, 0, 1);

    /* ======================= –î–ê–ù–ù–´–ï –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ ======================= */
    const seedPeople = [
      {id:"p1", name:"–°–∞—à–∞ –ö.", role:"manager"},
      {id:"p2", name:"–ê–Ω—è –ü.", role:"frontend"},
      {id:"p3", name:"–ò–≥–æ—Ä—å –°.", role:"backend"},
      {id:"p4", name:"–õ–µ–Ω–∞ –ú.", role:"qa"},
    ];
    const seedProjects = [
      {id:"pr1", name:"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥-—Å–∞–π—Ç", color:"#7dd3fc", status:"active"},
      {id:"pr2", name:"–õ–ö –ü–∞—Ä—Ç–Ω—ë—Ä–∞", color:"#93c5fd", status:"active"},
      {id:"pr3", name:"–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", color:"#a5b4fc", status:"paused"},
    ];
    // projectTeams: { projectId: Set(personId) }
    const seedProjectTeams = {
      pr1: new Set(["p1","p2","p4"]),
      pr2: new Set(["p1","p3"]),
      pr3: new Set(["p2","p3"]),
    };
    // assignments: Map key `${personId}|${projectId}|${weekISO}` -> fte number
    const seedAssignments = new Map();
    // –ø—Ä–æ—Å—Ç–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const anchor = startOfWeek(new Date());
    const initialWeeks = weeksRange(anchor.toISOString(), 12);
    for(const w of initialWeeks){
      seedAssignments.set(`p2|pr1|${w}`, 0.6);
      seedAssignments.set(`p4|pr1|${w}`, 0.4);
      seedAssignments.set(`p3|pr2|${w}`, 0.7);
      seedAssignments.set(`p2|pr3|${w}`, 0.3);
    }
    // vacations: Set `${personId}|${weekISO}`
    const seedVacations = new Set();

    const fteFor = (assignments, personId, projectId, weekISO) =>
      assignments.get(`${personId}|${projectId}|${weekISO}`) ?? 0;

    const setFteFor = (assignments, personId, projectId, weekISO, val) => {
      const next = new Map(assignments);
      const k = `${personId}|${projectId}|${weekISO}`;
      if(val && +val>0) next.set(k, +val);
      else next.delete(k);
      return next;
    };

    const totalFTEForPersonWeek = (assignments, personId, weekISO, projects) =>
      projects.reduce((s,pr)=> s + (assignments.get(`${personId}|${pr.id}|${weekISO}`) || 0), 0);

    const isVacation = (vacations, personId, weekISO) => vacations.has(`${personId}|${weekISO}`);

    /* ======================= –ò–ö–û–ù–ö–ò ======================= */
    const ChevronLeft = () => <span className="text-lg">‚Äπ</span>;
    const ChevronRight= () => <span className="text-lg">‚Ä∫</span>;
    const DragDots = () => <span className="text-neutral-400">‚ãÆ‚ãÆ</span>;

    /* ======================= –®–ê–ü–ö–ê (GLOBAL HEADER) ======================= */
    function AppHeader({ tab, setTab, onAddProject, onAddPerson }){
      const NavBtn = ({active, onClick, children}) => (
        <button onClick={onClick}
          className={
            "px-3 py-1.5 rounded-xl text-sm font-medium transition " +
            (active ? "bg-neutral-900 text-white"
                    : "bg-white text-neutral-800 border border-neutral-300 hover:bg-neutral-50")
          }>
          {children}
        </button>
      );
      const ActionBtn = ({onClick, children}) => (
        <button onClick={onClick} className="btn">{children}</button>
      );

      return (
        <header className="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-neutral-200">
          <div className="max-w-screen-2xl mx-auto px-4 h-[var(--app-header-h)] flex items-center justify-between gap-4">
            <div className="flex items-center gap-3">
              <div className="font-semibold tracking-wide mr-2">FTE Planner</div>
              <div className="flex items-center gap-2">
                <NavBtn active={tab==='load'} onClick={()=>setTab('load')}>–ù–∞–≥—Ä—É–∑–∫–∞</NavBtn>
                <NavBtn active={tab==='team'} onClick={()=>setTab('team')}>–ö–æ–º–∞–Ω–¥–∞</NavBtn>
                <NavBtn active={tab==='projects'} onClick={()=>setTab('projects')}>–ü—Ä–æ–µ–∫—Ç—ã</NavBtn>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <ActionBtn onClick={onAddProject}>+ –ü—Ä–æ–µ–∫—Ç</ActionBtn>
              <ActionBtn onClick={onAddPerson}>+ –°–æ—Ç—Ä—É–¥–Ω–∏–∫</ActionBtn>
            </div>
          </div>
        </header>
      );
    }

    /* ======================= –ö–ê–õ–ï–ù–î–ê–†–ù–ê–Ø –®–ê–ü–ö–ê (–ì–æ–¥ ‚Üí –ú–µ—Å—è—Ü—ã ‚Üí –ù–µ–¥–µ–ª–∏) ======================= */
    function CalendarHeader({visibleWeeks, leftLabel="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏", weekBadgeByISO=null, stickyTopClass="top-[var(--app-header-h)]"}){
      // –ì—Ä—É–ø–ø—ã –ø–æ –≥–æ–¥–∞–º
      const years = [];
      let cy=null, ccount=0;
      visibleWeeks.forEach((iso,i)=>{
        const y = new Date(iso).getFullYear();
        if(cy===null){ cy=y; ccount=1; }
        else if(y===cy){ ccount++; }
        else { years.push({year:cy,count:ccount}); cy=y; ccount=1; }
        if(i===visibleWeeks.length-1) years.push({year:cy,count:ccount});
      });
      // –ì—Ä—É–ø–ø—ã –ø–æ –º–µ—Å—è—Ü–∞–º
      const months = [];
      let key=null, count=0, y0=null, m0=null;
      visibleWeeks.forEach((iso,i)=>{
        const d=new Date(iso), y=d.getFullYear(), m=d.getMonth();
        const k=`${y}-${m}`;
        if(k!==key){
          if(key!==null) months.push({key, year:y0, month:m0, count});
          key=k; count=1; y0=y; m0=m;
        } else count++;
        if(i===visibleWeeks.length-1) months.push({key, year:y0, month:m0, count});
      });
      // –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–∞ (–¥–ª—è –ø–æ–¥–ø–∏—Å–∏ ¬´–ù–µ–¥–µ–ª—è N¬ª)
      const weekIndexInMonth = [];
      months.forEach(g => { for(let i=1;i<=g.count;i++) weekIndexInMonth.push(i); });
      const gridCols = `var(--left-col-w) repeat(${visibleWeeks.length}, ${WEEK_COL_PX}px)`;

      return (
        <div className={`sticky ${stickyTopClass} z-40`}>
          <div className="grid" style={{gridTemplateColumns:gridCols, rowGap:'6px'}}>
            {/* Left label */}
            <div className="sticky left-0 z-50 bg-[#F7F8FA] border-r border-neutral-200 p-1" style={{gridRow:"span 3 / span 3"}}>
              <div className="h-full rounded-2xl bg-white border border-neutral-200 shadow-sm flex items-center pl-5 text-sm text-neutral-700">
                {leftLabel}
              </div>
            </div>

            {/* Row 1: Years */}
            {years.map(g=>(
              <div key={`y-${g.year}`} style={{gridColumn:`span ${g.count}`}}>
                <div className="mx-1 rounded-xl px-3 py-1 text-center text-white text-sm font-medium bg-neutral-900">
                  {g.year} –≥.
                </div>
              </div>
            ))}

            {/* Row 2: Months */}
            {months.map(g=>(
              <div key={g.key} style={{gridColumn:`span ${g.count}`}}>
                <div className="mx-1 rounded-xl px-3 py-1.5 text-center text-[13px] font-medium bg-neutral-100 text-neutral-800 border border-neutral-200">
                  {RU_MONTHS_FULL[g.month]}
                </div>
              </div>
            ))}

            {/* Row 3: Weeks */}
            {visibleWeeks.map((iso, i)=>(
              <div key={`w-${iso}`} className="relative">
                <div className="mx-1 rounded-md px-2 py-1 text-center text-[12px] text-neutral-800 bg-white border border-neutral-200 shadow-sm select-none">
                  –ù–µ–¥–µ–ª—è {weekIndexInMonth[i]}
                </div>
                {weekBadgeByISO && weekBadgeByISO[iso]!=null && (
                  <div className="absolute -right-1 -top-2 translate-x-1/2">
                    <span className="px-2 py-0.5 rounded-full text-[11px] font-bold border border-neutral-300 bg-neutral-50 text-neutral-800 shadow-sm">
                      {weekBadgeByISO[iso]}
                    </span>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      );
    }

    /* ======================= –ù–ê–í–ò–ì–ê–¢–û–† –ù–ï–î–ï–õ–¨ ======================= */
    function WeekNavigator({
      onLeft, onRight, onToday,
      showToday=true,
      leftNode=null,
      stickyTopClass="top-[var(--app-header-h)]"
    }){
      return (
        <div className={`sticky ${stickyTopClass} z-30 bg-white/80 backdrop-blur border-b border-neutral-200`}>
          <div className="max-w-screen-2xl mx-auto px-4 h-[44px] flex items-center justify-between">
            <div className="flex items-center gap-2">{leftNode}</div>
            <div className="flex items-center gap-2">
              <button onClick={onLeft} className="btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–µ–¥–µ–ª–∏"><ChevronLeft/></button>
              {showToday && <button onClick={onToday} className="btn">–°–µ–≥–æ–¥–Ω—è</button>}
              <button onClick={onRight} className="btn" title="–°–ª–µ–¥—É—é—â–∏–µ –Ω–µ–¥–µ–ª–∏"><ChevronRight/></button>
            </div>
          </div>
        </div>
      );
    }

    /* ======================= –°–¢–†–ê–ù–ò–¶–ê ¬´–ù–ê–ì–†–£–ó–ö–ê¬ª ======================= */
    function LoadPage({people, projects, assignments, vacations, setAssignments, visible, setVisible, openPerson}){
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –Ω–µ–¥–µ–ª—å
      const goLeft = ()=> setVisible(prev => prev.map(w => addWeeks(w,-1)));
      const goRight= ()=> setVisible(prev => prev.map(w => addWeeks(w, 1)));
      const goToday= ()=> {
        const base = startOfWeek(new Date()).toISOString();
        setVisible(weeksRange(base, prevCount));
      };
      const prevCount = visible.length;

      // –í–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞ —Å –≥–æ–¥/–º–µ—Å—è—Ü/–Ω–µ–¥–µ–ª—è
      // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–æ–∫
      const gridCols = `var(--left-col-w) repeat(${visible.length}, ${WEEK_COL_PX}px)`;

      return (
        <div className="pb-24">
          <WeekNavigator
            onLeft={goLeft}
            onRight={goRight}
            onToday={goToday}
            showToday={false}
            leftNode={<div className="text-sm text-neutral-600">–§–∏–ª—å—Ç—Ä—ã –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–µ–ª–∫–∏</div>}
          />
          <div className="max-w-screen-2xl mx-auto px-4">
            <CalendarHeader visibleWeeks={visible} leftLabel="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏" />
            {/* –¢–∞–±–ª–∏—Ü–∞ –±–∞—Ä–æ–≤ */}
            <div className="grid" style={{gridTemplateColumns:gridCols}}>
              {/* –õ–µ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü ‚Äî —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ */}
              {people.map(person => (
                <Fragment key={person.id}>
                  <div className="sticky left-0 z-20 bg-[#F7F8FA] border-r border-neutral-200 p-1">
                    <div
                      className="bg-white rounded-2xl shadow-sm h-[var(--row-h)] flex items-center justify-between pl-5 pr-3">
                      <div>
                        <div className="font-medium">{person.name}</div>
                        <div className="text-sm text-neutral-500">{(person.role||"other").toUpperCase()}</div>
                      </div>
                      <button className="tag" onClick={()=>openPerson(person.id)}>–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                  </div>
                  {/* –ë–∞—Ä—ã –ø–æ –Ω–µ–¥–µ–ª—è–º */}
                  {visible.map(week => {
                    // —Å—É–º–º–∞—Ä–Ω—ã–π FTE –ø–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–∞–º
                    const sum = totalFTEForPersonWeek(assignments, person.id, week, projects);
                    const vac = isVacation(vacations, person.id, week);
                    return (
                      <div key={person.id+week} className="p-1">
                        <div className="bg-white rounded-2xl shadow-sm h-[var(--row-h)] flex items-end justify-center relative">
                          {vac ? (
                            <div className="absolute inset-0 flex items-center justify-center text-2xl" title="–û—Ç–ø—É—Å–∫">üèñ</div>
                          ) : (
                            <div className="absolute inset-0 flex items-center justify-center text-sm font-semibold text-neutral-800">
                              {fmtFTE1(sum)}
                            </div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </Fragment>
              ))}
            </div>
          </div>
        </div>
      );
    }

    /* ======================= –°–¢–†–ê–ù–ò–¶–ê ¬´–ö–û–ú–ê–ù–î–ê¬ª (—Ç–∞–±–ª–∏—á–Ω—ã–π –≤–∏–¥) ======================= */
    function TeamPage({people, setPeople}){
      const removePerson = (id) => {
        if(!confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?")) return;
        setPeople(prev => prev.filter(p=>p.id!==id));
      };
      return (
        <div className="max-w-screen-2xl mx-auto px-4 py-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {people.map(p=>(
              <div key={p.id} className="bg-white rounded-2xl border border-neutral-200 shadow-sm p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="font-medium">{p.name}</div>
                    <div className="text-sm text-neutral-500">{(p.role||"other").toUpperCase()}</div>
                  </div>
                  <button className="btn" onClick={()=>removePerson(p.id)}>–£–¥–∞–ª–∏—Ç—å</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    /* ======================= –°–¢–†–ê–ù–ò–¶–ê ¬´–ü–†–û–ï–ö–¢–´¬ª ======================= */
    function ProjectTeamSelector({project, people, projectTeams, setProjectTeams}){
      const [search,setSearch]=useState("");
      const team = projectTeams[project.id] || new Set();
      const available = useMemo(
        ()=> people.filter(p => !team.has(p.id) && (p.name.toLowerCase().includes(search.toLowerCase()))).slice(0,8),
        [people, team, search]
      );
      const addToTeam = (pid) => {
        const next = {...projectTeams, [project.id]: new Set(team)};
        next[project.id].add(pid);
        setProjectTeams(next);
      };
      const removeFromTeam = (pid) => {
        const next = {...projectTeams, [project.id]: new Set(team)};
        next[project.id].delete(pid);
        setProjectTeams(next);
      };
      return (
        <div className="mt-3 space-y-2">
          <div className="text-sm text-neutral-600">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</div>
          <div className="flex flex-wrap gap-2">
            {[...team].map(pid=>{
              const person = people.find(p=>p.id===pid);
              if(!person) return null;
              return (
                <span key={pid} className="tag flex items-center gap-2">
                  {person.name}
                  <button className="text-xs" onClick={()=>removeFromTeam(pid)}>√ó</button>
                </span>
              );
            })}
          </div>
          <div className="pt-2">
            <input className="w-full px-3 py-2 border border-neutral-300 rounded-xl bg-white"
                   placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞‚Ä¶" value={search} onChange={e=>setSearch(e.target.value)} />
            <div className="mt-2 flex flex-wrap gap-2">
              {available.map(p=>(
                <button key={p.id} className="tag hover:bg-neutral-100" onClick={()=>addToTeam(p.id)}>{p.name}</button>
              ))}
            </div>
          </div>
        </div>
      );
    }

    function ProjectsPage({projects, setProjects, people, projectTeams, setProjectTeams}){
      const removeProject = (id) => {
        if(!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?")) return;
        setProjects(prev => prev.filter(p=>p.id!==id));
        const next = {...projectTeams}; delete next[id]; setProjectTeams(next);
      };
      return (
        <div className="max-w-screen-2xl mx-auto px-4 py-6 grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
          {projects.map(pr=>(
            <div key={pr.id} className="bg-white rounded-2xl border border-neutral-200 shadow-sm p-4">
              <div className="flex items-center justify-between">
                <div className="font-medium">{pr.name}</div>
                <button className="btn" onClick={()=>removeProject(pr.id)}>–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
              </div>
              <div className="mt-2 text-sm text-neutral-600">–°—Ç–∞—Ç—É—Å: <span className="tag">{pr.status}</span></div>
              <ProjectTeamSelector
                project={pr}
                people={people}
                projectTeams={projectTeams}
                setProjectTeams={setProjectTeams}
              />
            </div>
          ))}
        </div>
      );
    }

    /* ======================= –°–¢–†–ê–ù–ò–¶–ê –û–î–ù–û–ì–û –°–û–¢–†–£–î–ù–ò–ö–ê ======================= */
    function PersonPage({
      personId, back, people, projects,
      assignments, setAssignments,
      vacations, setVacations,
      visible, setVisible
    }){
      const person = people.find(p=>p.id===personId);
      const [orderedIds, setOrderedIds] = useState(projects.map(p=>p.id));
      const [dragIdx, setDragIdx] = useState(null);
      const beginDrag = (i)=> setDragIdx(i);
      const dropAt = (i)=>{
        if(dragIdx==null || dragIdx===i) return;
        const next = [...orderedIds];
        const [m] = next.splice(dragIdx,1);
        next.splice(i,0,m);
        setOrderedIds(next);
        setDragIdx(null);
      };

      const goLeft = ()=> setVisible(prev => prev.map(w => addWeeks(w,-1)));
      const goRight= ()=> setVisible(prev => prev.map(w => addWeeks(w, 1)));
      const goToday= ()=> {
        const base = startOfWeek(new Date()).toISOString();
        setVisible(weeksRange(base, prevCount));
      };
      const prevCount = visible.length;

      const edit = (pid, weekISO) => {
        const current = fteFor(assignments, person.id, pid, weekISO);
        const val = prompt("FTE (0..1)", String(current));
        if(val===null) return;
        const f = Math.max(0, Math.min(1, parseFloat(val)||0));
        setAssignments(prev => setFteFor(prev, person.id, pid, weekISO, f));
      };

      const clearVacationWeek = (weekISO) => {
        const key = `${person.id}|${weekISO}`;
        const next = new Set(vacations);
        if(next.has(key)) next.delete(key);
        else next.add(key);
        setVacations(next);
      };

      const gridCols = `var(--left-col-w) repeat(${visible.length}, ${WEEK_COL_PX}px)`;

      // Œ£ FTE –±–µ–π–¥–∂–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º
      const weekTotals = visible.map(w => totalFTEForPersonWeek(assignments, person.id, w, projects));
      const badge = {}; visible.forEach((w,i)=>{ badge[w] = `Œ£ ${fmtFTE1(weekTotals[i])}`; });

      return (
        <div className="pb-24">
          <WeekNavigator
            onLeft={goLeft}
            onRight={goRight}
            onToday={goToday}
            showToday={false}
            leftNode={
              <div className="flex items-center gap-2">
                <button className="btn" onClick={back}>‚Üê –ù–∞–∑–∞–¥</button>
                <div className="text-sm text-neutral-600">{person?.name}</div>
              </div>
            }
          />
          <div className="max-w-screen-2xl mx-auto px-4">
            <CalendarHeader visibleWeeks={visible} leftLabel="–ü—Ä–æ–µ–∫—Ç—ã" weekBadgeByISO={badge}/>
            {/* –¢–∞–±–ª–∏—Ü–∞ –±–∞—Ä–æ–≤ */}
            <div className="grid pb-4" style={{gridTemplateColumns:gridCols}}>
              {orderedIds.map((pid, idx)=>{
                const pr = projects.find(p=>p.id===pid); if(!pr) return null;
                return (
                  <Fragment key={pid}>
                    <div
                      className="sticky left-0 z-20 bg-[#F7F8FA] border-r border-neutral-200 p-1"
                      draggable
                      onDragStart={()=>beginDrag(idx)}
                      onDragOver={(e)=>e.preventDefault()}
                      onDrop={()=>dropAt(idx)}
                    >
                      <div className="bg-white rounded-2xl shadow-sm h-[var(--row-h)] flex items-center gap-2 pl-5 pr-3 cursor-grab active:cursor-grabbing select-none">
                        <DragDots/>
                        <div className="w-6 h-6 rounded-lg" style={{background:pr.color}} title="–¶–≤–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞"></div>
                        <div className="font-medium truncate" title={pr.name}>{pr.name}</div>
                      </div>
                    </div>
                    {visible.map(week=>{
                      const fte = fteFor(assignments, person.id, pid, week);
                      const vac = isVacation(vacations, person.id, week);
                      const ratio = scaleRatio(fte);
                      return (
                        <div key={pid+week} className="p-1">
                          <div className="bg-white rounded-2xl shadow-sm h-[var(--row-h)] flex items-end justify-center relative">
                            <div className="relative w-14 h-[92%] rounded-lg bg-neutral-200 overflow-hidden">
                              {!vac && <div className="absolute bottom-0 left-0 right-0" style={{height:`${ratio*100}%`, background:pr.color}}/>}
                            </div>
                            {!vac ? (
                              <button className="absolute inset-0 flex items-center justify-center text-sm font-semibold" title="–ò–∑–º–µ–Ω–∏—Ç—å FTE" onClick={()=>edit(pid, week)}>
                                {fmtFTE1(fte)}
                              </button>
                            ) : (
                              <button className="absolute inset-0 flex items-center justify-center text-2xl" title="–°–Ω—è—Ç—å –æ—Ç–ø—É—Å–∫" onClick={()=>clearVacationWeek(week)}>üèñ</button>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </Fragment>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    /* ======================= –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ======================= */
    function App(){
      const [tab, setTab] = useState("load"); // load | team | projects | person
      const [people, setPeople] = useState(seedPeople);
      const [projects, setProjects] = useState(seedProjects);
      const [projectTeams, setProjectTeams] = useState(seedProjectTeams);
      const [assignments, setAssignments] = useState(seedAssignments);
      const [vacations, setVacations] = useState(seedVacations);

      // –∫–∞–ª–µ–Ω–¥–∞—Ä—å
      const [visible, setVisible] = useState(initialWeeks);

      // –Ω–∞–≤–∏–≥–∞—Ü–∏—è
      const [personId, setPersonId] = useState(null);
      const openPerson = (id)=>{ setPersonId(id); setTab("person"); };

      // add actions
      const onAddProject = () => {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"); if(!name) return;
        const id = "pr" + Math.random().toString(36).slice(2,7);
        setProjects(prev => [...prev, {id, name, color:"#c7d2fe", status:"active"}]);
        setProjectTeams(prev => ({...prev, [id]: new Set()}));
      };
      const onAddPerson = () => {
        const name = prompt("–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"); if(!name) return;
        const role = prompt("–†–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: frontend, backend, manager)","frontend") || "other";
        const id = "p" + Math.random().toString(36).slice(2,7);
        setPeople(prev => [...prev, {id, name, role}]);
      };

      // –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
      let page = null;
      if(tab==="load"){
        page = (
          <LoadPage
            people={people}
            projects={projects}
            assignments={assignments}
            vacations={vacations}
            setAssignments={setAssignments}
            visible={visible}
            setVisible={setVisible}
            openPerson={openPerson}
          />
        );
      } else if(tab==="team"){
        page = <TeamPage people={people} setPeople={setPeople} />;
      } else if(tab==="projects"){
        page = (
          <ProjectsPage
            projects={projects}
            setProjects={setProjects}
            people={people}
            projectTeams={projectTeams}
            setProjectTeams={setProjectTeams}
          />
        );
      } else if(tab==="person"){
        page = (
          <PersonPage
            personId={personId}
            back={()=>setTab("load")}
            people={people}
            projects={projects}
            assignments={assignments}
            setAssignments={setAssignments}
            vacations={vacations}
            setVacations={setVacations}
            visible={visible}
            setVisible={setVisible}
          />
        );
      }

      return (
        <div>
          <AppHeader tab={tab} setTab={setTab} onAddProject={onAddProject} onAddPerson={onAddPerson}/>
          {page}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
